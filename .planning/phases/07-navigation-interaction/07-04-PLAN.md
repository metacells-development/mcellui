---
phase: 07-navigation-interaction
plan: 04
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - packages/registry/ui/carousel.tsx
  - packages/registry/ui/swipeable-row.tsx
autonomous: true

must_haves:
  truths:
    - "Carousel component uses carouselTokens for indicator dimensions"
    - "Carousel uses CAROUSEL_CONSTANTS for autoplay and scroll throttle"
    - "Carousel indicator uses componentRadius.carousel"
    - "SwipeableRow uses swipeableRowTokens for action button dimensions"
    - "SwipeableRow uses SWIPEABLE_ROW_CONSTANTS for spring and velocity thresholds"
  artifacts:
    - path: "packages/registry/ui/carousel.tsx"
      provides: "Carousel with centralized tokens"
      contains: "carouselTokens"
    - path: "packages/registry/ui/swipeable-row.tsx"
      provides: "SwipeableRow with centralized tokens"
      contains: "swipeableRowTokens"
  key_links:
    - from: "packages/registry/ui/carousel.tsx"
      to: "packages/core/src/theme/components.ts"
      via: "import carouselTokens"
      pattern: "carouselTokens|CAROUSEL_CONSTANTS"
    - from: "packages/registry/ui/swipeable-row.tsx"
      to: "packages/core/src/theme/components.ts"
      via: "import swipeableRowTokens"
      pattern: "swipeableRowTokens|SWIPEABLE_ROW_CONSTANTS"
---

<objective>
Migrate Carousel and SwipeableRow components to use centralized token system

Purpose: Replace hardcoded indicator dimensions, animation configs, and action button sizing with carouselTokens, swipeableRowTokens, and associated constants for theme consistency.

Output: Updated carousel.tsx and swipeable-row.tsx using centralized tokens
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-navigation-interaction/07-01-SUMMARY.md
@packages/registry/ui/carousel.tsx
@packages/registry/ui/swipeable-row.tsx
@packages/core/src/theme/components.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Carousel to centralized tokens</name>
  <files>packages/registry/ui/carousel.tsx</files>
  <action>
Update Carousel component to use centralized tokens. Key changes:

1. Import tokens at top of file:
```typescript
import {
  useTheme,
  carouselTokens,
  CAROUSEL_CONSTANTS,
} from '@metacells/mcellui-core';
```

2. In CarouselInner component:
- Replace `autoplayInterval = 4000` default with `CAROUSEL_CONSTANTS.autoplayInterval`
- Replace `scrollEventThrottle={16}` with `CAROUSEL_CONSTANTS.scrollEventThrottle`

3. In AnimatedDot component:
- Replace hardcoded interpolation values with tokens:
  - `[8, 24, 8]` for line variant -> `[carouselTokens.indicator.dotSize, carouselTokens.lineIndicator.activeWidth, carouselTokens.indicator.dotSize]`
  - `[8, 12, 8]` for dot variant -> `[carouselTokens.indicator.dotSize, carouselTokens.indicator.dotSize * 1.5, carouselTokens.indicator.dotSize]` (or just leave as relative scaling)
  - `[0.4, 1, 0.4]` for opacity -> `[carouselTokens.indicator.dotInactiveOpacity, 1, carouselTokens.indicator.dotInactiveOpacity]`
  - `[0.8, 1, 0.8]` for scale -> `[carouselTokens.indicator.dotInactiveScale, carouselTokens.indicator.dotActiveScale, carouselTokens.indicator.dotInactiveScale]`

4. Update StyleSheet:
- Replace `gap: 6` in indicators with `carouselTokens.indicator.gap`
- Replace `paddingVertical: 8` in indicators with `carouselTokens.indicator.paddingVertical`
- Replace `height: 8` in dot with `carouselTokens.indicator.dotSize`
- Replace `borderRadius: 4` in dot with `carouselTokens.indicator.dotSize / 2` (or use componentRadius.carousel)

Note: Use componentRadius.carousel from useTheme() for indicator dot borderRadius for pill shape.
  </action>
  <verify>
Run TypeScript compilation:
```bash
cd /Users/johanneschristler/Code/metacells/other/mcellui && npx tsc --noEmit -p packages/registry/tsconfig.json
```
Verify no errors. Check that carousel.tsx imports carouselTokens and CAROUSEL_CONSTANTS.
  </verify>
  <done>
Carousel component uses carouselTokens for indicator dimensions and animation values. Uses CAROUSEL_CONSTANTS for autoplay interval and scroll throttle. No hardcoded indicator sizes or animation values remain.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate SwipeableRow to centralized tokens</name>
  <files>packages/registry/ui/swipeable-row.tsx</files>
  <action>
Update SwipeableRow component to use centralized tokens. Key changes:

1. Import tokens at top of file:
```typescript
import {
  useTheme,
  areAnimationsDisabled,
  swipeableRowTokens,
  SWIPEABLE_ROW_CONSTANTS,
} from '@metacells/mcellui-core';
```

2. Replace local constants:
- Delete: `const ACTION_WIDTH = 80;`
- Delete: `const SPRING_CONFIG = { damping: 20, stiffness: 200 };`
- Use: `SWIPEABLE_ROW_CONSTANTS.actionWidth`, `SWIPEABLE_ROW_CONSTANTS.spring`

3. In SwipeableRow component:
- Replace `actionWidth = ACTION_WIDTH` default with `SWIPEABLE_ROW_CONSTANTS.actionWidth`
- Replace `fullSwipeThreshold = SCREEN_WIDTH * 0.5` with `SCREEN_WIDTH * SWIPEABLE_ROW_CONSTANTS.fullSwipeRatio`
- Replace hardcoded `0.3` resistance factor with `SWIPEABLE_ROW_CONSTANTS.resistanceFactor`
- Replace velocity threshold `500` / `-500` with `SWIPEABLE_ROW_CONSTANTS.velocityThreshold`

4. In ActionButton component:
- Replace `paddingHorizontal: 8` with `swipeableRowTokens.action.paddingHorizontal`
- Replace `marginBottom: 4` in actionIcon with `swipeableRowTokens.action.iconMargin`
- Replace `fontSize: 12` with `swipeableRowTokens.action.labelFontSize`
- Replace `fontWeight: '600'` with `swipeableRowTokens.action.labelFontWeight`

5. Update spring usage in callbacks (close, openRight, openLeft):
- Replace `SPRING_CONFIG` with `SWIPEABLE_ROW_CONSTANTS.spring`
  </action>
  <verify>
Run TypeScript compilation:
```bash
cd /Users/johanneschristler/Code/metacells/other/mcellui && npx tsc --noEmit -p packages/registry/tsconfig.json
```
Verify no errors. Check that swipeable-row.tsx imports swipeableRowTokens and SWIPEABLE_ROW_CONSTANTS.
  </verify>
  <done>
SwipeableRow component uses swipeableRowTokens for action button styling. Uses SWIPEABLE_ROW_CONSTANTS for spring config, velocity thresholds, action width, and resistance factor. No hardcoded animation or dimension values remain.
  </done>
</task>

</tasks>

<verification>
1. carousel.tsx imports carouselTokens, CAROUSEL_CONSTANTS from @metacells/mcellui-core
2. Carousel uses CAROUSEL_CONSTANTS.autoplayInterval as default
3. AnimatedDot uses carouselTokens for dotSize, opacity, scale interpolation
4. Indicator styles use carouselTokens.indicator.gap, paddingVertical
5. swipeable-row.tsx imports swipeableRowTokens, SWIPEABLE_ROW_CONSTANTS from @metacells/mcellui-core
6. SwipeableRow uses SWIPEABLE_ROW_CONSTANTS.spring for animations
7. ActionButton uses swipeableRowTokens.action for dimensions and typography
8. Velocity threshold uses SWIPEABLE_ROW_CONSTANTS.velocityThreshold (not hardcoded 500)
9. TypeScript compiles for registry package
</verification>

<success_criteria>
- No hardcoded numeric values for indicator dimensions in carousel.tsx
- No hardcoded animation config in swipeable-row.tsx
- Autoplay default uses CAROUSEL_CONSTANTS.autoplayInterval (4000)
- Action button typography uses swipeableRowTokens.action.labelFontSize/labelFontWeight
- Demo app compiles and renders both components correctly
</success_criteria>

<output>
After completion, create `.planning/phases/07-navigation-interaction/07-04-SUMMARY.md`
</output>
