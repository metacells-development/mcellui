---
phase: 08-advanced-components
plan: 04
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - packages/registry/ui/image-gallery.tsx
  - packages/registry/ui/pagination.tsx
  - packages/registry/ui/stories.tsx
autonomous: true

must_haves:
  truths:
    - "ImageGallery uses imageGalleryTokens for fullscreen viewer dimensions"
    - "Pagination uses paginationTokens for dot/button sizing"
    - "Stories uses storiesTokens for avatar ring dimensions"
  artifacts:
    - path: "packages/registry/ui/image-gallery.tsx"
      provides: "Token-based ImageGallery component"
      contains: "imageGalleryTokens"
    - path: "packages/registry/ui/pagination.tsx"
      provides: "Token-based Pagination component"
      contains: "paginationTokens"
    - path: "packages/registry/ui/stories.tsx"
      provides: "Token-based Stories component"
      contains: "storiesTokens"
  key_links:
    - from: "packages/registry/ui/pagination.tsx"
      to: "packages/core/src/theme/components.ts"
      via: "import paginationTokens"
      pattern: "paginationTokens"
---

<objective>
Migrate ImageGallery, Pagination, and Stories to use centralized tokens from core theme.

Purpose: Replace hardcoded dimensions in fullscreen viewer, pagination dots, and story avatars with theme tokens.

Output: All three components consume tokens from components.ts, eliminating magic numbers.
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/08-advanced-components/08-01-SUMMARY.md
@packages/core/src/theme/components.ts
@packages/registry/ui/image-gallery.tsx
@packages/registry/ui/pagination.tsx
@packages/registry/ui/stories.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate ImageGallery to imageGalleryTokens</name>
  <files>packages/registry/ui/image-gallery.tsx</files>
  <action>
1. Import imageGalleryTokens (or access via useTheme).

2. Replace fullscreen viewer hardcoded values:
   ```typescript
   // BEFORE
   fullscreenBackdrop: { backgroundColor: 'rgba(0, 0, 0, 0.95)' }
   closeButton: { top: Platform.OS === 'ios' ? 50 : 20, right: 20 }
   closeIcon: { width: 36, height: 36, borderRadius: 18 }
   closeLine: { width: 18, height: 2, borderRadius: 1 }
   pageIndicator: { bottom: 50 }
   pageDot: { width: 6, height: 6, borderRadius: 3 }

   // AFTER
   const tokens = imageGalleryTokens;
   // Use tokens.fullscreen.* values
   style={{
     top: Platform.OS === 'ios' ? tokens.fullscreen.closeButtonTop : tokens.fullscreen.closeButtonTopAndroid,
     right: 20,
   }}
   style={{
     width: tokens.fullscreen.closeButtonSize,
     height: tokens.fullscreen.closeButtonSize,
     borderRadius: tokens.fullscreen.closeButtonSize / 2,
   }}
   ```

3. Replace page indicator gap:
   ```typescript
   // BEFORE
   pageIndicator: { gap: 6 }

   // AFTER
   style={{ gap: tokens.fullscreen.dotGap }}
   ```

4. Replace pageDot dimensions:
   ```typescript
   // BEFORE
   pageDot: { width: 6, height: 6, borderRadius: 3 }

   // AFTER
   style={{
     width: tokens.fullscreen.dotSize,
     height: tokens.fullscreen.dotSize,
     borderRadius: tokens.fullscreen.dotSize / 2,
   }}
   ```

Keep gesture handling (pinch, pan, double tap) unchanged - correct implementation.
  </action>
  <verify>TypeScript compiles: `cd packages/registry && npx tsc --noEmit`</verify>
  <done>ImageGallery uses imageGalleryTokens for fullscreen viewer dimensions</done>
</task>

<task type="auto">
  <name>Task 2: Migrate Pagination to paginationTokens</name>
  <files>packages/registry/ui/pagination.tsx</files>
  <action>
1. Import paginationTokens (or access via useTheme).

2. Replace SIZE_CONFIG with paginationTokens:
   ```typescript
   // BEFORE
   const SIZE_CONFIG = {
     sm: { dotSize: 6, dotGap: 6, buttonSize: 28, fontSize: 12, numberSize: 28 },
     md: { dotSize: 8, dotGap: 8, buttonSize: 36, fontSize: 14, numberSize: 36 },
     lg: { dotSize: 10, dotGap: 10, buttonSize: 44, fontSize: 16, numberSize: 44 },
   };

   // AFTER - use paginationTokens directly
   const tokens = paginationTokens;
   const config = tokens[size];
   ```

3. Replace simpleButton hardcoded gap:
   ```typescript
   // BEFORE
   simpleButton: { gap: 4 }

   // AFTER
   style={{ gap: tokens.simple.gap }}
   ```

4. Update all references from SIZE_CONFIG to tokens throughout the component.

Keep animation logic for AnimatedDot unchanged - correct implementation.
  </action>
  <verify>TypeScript compiles: `cd packages/registry && npx tsc --noEmit`</verify>
  <done>Pagination uses paginationTokens for all dot/button sizing, SIZE_CONFIG removed</done>
</task>

<task type="auto">
  <name>Task 3: Migrate Stories to storiesTokens</name>
  <files>packages/registry/ui/stories.tsx</files>
  <action>
1. Import storiesTokens (or access via useTheme).

2. Replace SIZE_CONFIG with storiesTokens:
   ```typescript
   // BEFORE
   const SIZE_CONFIG = {
     sm: { outer: 56, inner: 50, avatar: 46, borderWidth: 3, fontSize: 10, plusSize: 14 },
     md: { outer: 72, inner: 64, avatar: 60, borderWidth: 3, fontSize: 11, plusSize: 18 },
     lg: { outer: 88, inner: 80, avatar: 74, borderWidth: 4, fontSize: 12, plusSize: 22 },
   };

   // AFTER
   const tokens = storiesTokens;
   const config = tokens[size];
   ```

3. Replace hardcoded name marginTop:
   ```typescript
   // BEFORE
   name: { marginTop: 4 }

   // AFTER
   style={{ marginTop: config.nameMarginTop }}
   ```

4. Update StoriesRow to use tokens.row:
   ```typescript
   // BEFORE
   contentContainerStyle={[
     styles.rowContent,
     { paddingHorizontal: spacing[4], gap: spacing[3] },
     contentContainerStyle,
   ]}

   // AFTER
   contentContainerStyle={[
     styles.rowContent,
     { paddingHorizontal: tokens.row.paddingHorizontal, gap: tokens.row.gap },
     contentContainerStyle,
   ]}
   ```

Keep animation logic for press feedback unchanged - correct implementation.
  </action>
  <verify>TypeScript compiles: `cd packages/registry && npx tsc --noEmit`</verify>
  <done>Stories uses storiesTokens for all avatar dimensions and row layout</done>
</task>

</tasks>

<verification>
1. `cd packages/registry && npx tsc --noEmit` passes
2. ImageGallery.tsx contains `imageGalleryTokens` reference
3. Pagination.tsx contains `paginationTokens` reference, SIZE_CONFIG removed
4. Stories.tsx contains `storiesTokens` reference, SIZE_CONFIG removed
5. All three components maintain visual appearance
</verification>

<success_criteria>
- ImageGallery uses imageGalleryTokens for fullscreen viewer layout
- Pagination uses paginationTokens for dot/button sizing
- Stories uses storiesTokens for avatar ring dimensions
- All three components' StyleSheets reduced to structural styles only
- TypeScript compilation succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/08-advanced-components/08-04-SUMMARY.md`
</output>
