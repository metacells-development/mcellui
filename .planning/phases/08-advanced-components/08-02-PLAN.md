---
phase: 08-advanced-components
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - packages/registry/ui/calendar.tsx
  - packages/registry/ui/datetime-picker.tsx
autonomous: true

must_haves:
  truths:
    - "Calendar uses calendarTokens from core theme for all sizing"
    - "DateTimePicker uses dateTimePickerTokens for sheet/input layout"
    - "No hardcoded padding/margin/gap values in either component"
  artifacts:
    - path: "packages/registry/ui/calendar.tsx"
      provides: "Token-based Calendar component"
      contains: "calendarTokens"
    - path: "packages/registry/ui/datetime-picker.tsx"
      provides: "Token-based DateTimePicker component"
      contains: "dateTimePickerTokens"
  key_links:
    - from: "packages/registry/ui/calendar.tsx"
      to: "packages/core/src/theme/components.ts"
      via: "import calendarTokens"
      pattern: "calendarTokens"
    - from: "packages/registry/ui/datetime-picker.tsx"
      to: "packages/core/src/theme/components.ts"
      via: "import dateTimePickerTokens"
      pattern: "dateTimePickerTokens"
---

<objective>
Migrate Calendar and DateTimePicker components to use centralized tokens from core theme.

Purpose: Replace hardcoded spacing/sizing values with theme tokens for consistent theming across all advanced components.

Output: Both components consume tokens from components.ts, eliminating magic numbers.
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/08-advanced-components/08-01-SUMMARY.md
@packages/core/src/theme/components.ts
@packages/registry/ui/calendar.tsx
@packages/registry/ui/datetime-picker.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Calendar to calendarTokens</name>
  <files>packages/registry/ui/calendar.tsx</files>
  <action>
1. Import calendarTokens:
   Add `calendarTokens` to the import from '@metacells/mcellui-core' (or import directly if needed).

2. Replace SIZE_CONFIG with calendarTokens consumption:
   The existing SIZE_CONFIG pattern is good but uses hardcoded values. Replace:
   ```typescript
   // BEFORE
   const SIZE_CONFIG = {
     sm: { daySize: 32, fontSize: 12, headerFontSize: 14, gap: 2 },
     md: { daySize: 40, fontSize: 14, headerFontSize: 16, gap: 4 },
   };
   ```

   WITH token consumption in the component:
   ```typescript
   const { calendarTokens } = useTheme(); // or import directly
   const config = calendarTokens[size];
   ```

3. Replace hardcoded container padding:
   ```typescript
   // BEFORE (in styles)
   container: { padding: 8 }

   // AFTER (inline style)
   style={[{ padding: config.containerPadding }, style]}
   ```

4. Replace hardcoded navButton padding:
   ```typescript
   // BEFORE
   navButton: { padding: 8 }

   // AFTER
   <Pressable style={{ padding: config.navButtonPadding }}>
   ```

5. Replace weekday width:
   ```typescript
   // BEFORE
   { width: 24 }

   // AFTER
   { width: config.weekNumberWidth }
   ```

6. Remove static StyleSheet.create entries that are now dynamic, keep structural styles only.

Keep existing animation logic (withSpring, damping, stiffness) - those are correct.
  </action>
  <verify>TypeScript compiles: `cd packages/registry && npx tsc --noEmit`</verify>
  <done>Calendar uses calendarTokens for all sizing/spacing, no hardcoded values except radius.full for day cell (intentional)</done>
</task>

<task type="auto">
  <name>Task 2: Migrate DateTimePicker to dateTimePickerTokens</name>
  <files>packages/registry/ui/datetime-picker.tsx</files>
  <action>
1. Import dateTimePickerTokens (or access via theme if exported there).

2. Replace input styling hardcoded values:
   ```typescript
   // BEFORE
   iconContainer: { marginLeft: 8 }

   // AFTER
   style={[styles.iconContainer, { marginLeft: tokens.input.iconMarginLeft }]}
   ```

3. Replace sheet styling:
   ```typescript
   // BEFORE
   sheet: { borderTopLeftRadius: 20, borderTopRightRadius: 20 }
   handleContainer: { paddingVertical: 12 }

   // AFTER
   const tokens = dateTimePickerTokens;
   <View style={{
     borderTopLeftRadius: tokens.sheet.borderRadius,
     borderTopRightRadius: tokens.sheet.borderRadius
   }}>
   <View style={{ paddingVertical: tokens.sheet.handlePaddingVertical }}>
   ```

4. Replace handle dimensions:
   ```typescript
   // BEFORE
   handle: { width: 36, height: 4, borderRadius: 2 }

   // AFTER
   { width: tokens.sheet.handleWidth, height: tokens.sheet.handleHeight, borderRadius: 2 }
   ```

5. Replace picker container padding:
   ```typescript
   // BEFORE
   pickerContainer: { paddingVertical: 16 }

   // AFTER
   style={{ paddingVertical: tokens.sheet.pickerPaddingVertical }}
   ```

6. Replace fallback (Expo Go) styling:
   ```typescript
   // BEFORE
   expoGoFallback: { padding: 24, gap: 12 }

   // AFTER
   style={{ padding: tokens.fallback.padding, gap: tokens.fallback.gap }}
   ```

7. Replace calendar icon dimensions:
   ```typescript
   // BEFORE
   calendarIcon: { width: 20, height: 20 }
   calendarTop: { width: 14, height: 3 }
   calendarBody: { width: 16, height: 14 }
   calendarDots: { gap: 3 }
   calendarDot: { width: 3, height: 3 }

   // AFTER - use tokens.icon values
   ```

Keep gesture handling logic unchanged - it uses proper animation values.
  </action>
  <verify>TypeScript compiles: `cd packages/registry && npx tsc --noEmit`</verify>
  <done>DateTimePicker uses dateTimePickerTokens for all layout values, StyleSheet reduced to structural styles only</done>
</task>

</tasks>

<verification>
1. `cd packages/registry && npx tsc --noEmit` passes
2. Calendar.tsx contains `calendarTokens` reference
3. DateTimePicker.tsx contains `dateTimePickerTokens` reference
4. grep for hardcoded numbers in both files returns only intentional values (animation durations, borderRadius: 2 for handle)
</verification>

<success_criteria>
- Calendar uses calendarTokens from core for daySize, fontSize, gap, padding
- DateTimePicker uses dateTimePickerTokens for sheet/input/icon dimensions
- Both components maintain visual appearance (same pixel values, just tokenized)
- TypeScript compilation succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/08-advanced-components/08-02-SUMMARY.md`
</output>
