---
phase: 16-mcp-server-tool-quality
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/mcp-server/src/resources/index.ts
autonomous: true

must_haves:
  truths:
    - "All 7 resources have metadata with description, sizeHint, and lastUpdated"
    - "Resource descriptions help agents decide whether to fetch without reading content"
    - "Resource not found returns an error-style response with available URIs"
    - "Registry and tokens resources have error responses with recovery hints"
  artifacts:
    - path: "packages/mcp-server/src/resources/index.ts"
      provides: "Rich resource metadata and improved error handling"
      contains: "sizeHint"
  key_links:
    - from: "packages/mcp-server/src/resources/index.ts"
      to: "MCP resource listing"
      via: "resources array export"
      pattern: "export const resources"
---

<objective>
Add rich metadata to all 7 MCP resources and improve error handling in resource reads.

Purpose: Agents use resource metadata (description, sizeHint) to decide whether to fetch a resource. Without metadata, agents fetch large resources unnecessarily. Error responses should guide agents to valid URIs.

Output: Updated `resources` array and `handleResourceRead` function in `packages/mcp-server/src/resources/index.ts` with metadata and improved error handling.
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-mcp-server-tool-quality/16-RESEARCH.md
@.planning/phases/16-mcp-server-tool-quality/16-CONTEXT.md
@packages/mcp-server/src/resources/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add metadata to all resource definitions</name>
  <files>packages/mcp-server/src/resources/index.ts</files>
  <action>
Update the `resources` array to include rich metadata for each resource. The MCP Resource type supports an optional `metadata` field (Record of string to unknown). Add `description` improvements and metadata to each:

1. `mcellui://registry`:
   - description: `"Full list of all mcellui components with metadata (27 UI components + 6 blocks). JSON format with name, type, category, status, dependencies, and files for each component."`
   - metadata: `{ sizeHint: '15KB', lastUpdated: '2026-01-27', componentCount: 33 }`

2. `mcellui://tokens`:
   - description: `"Design tokens for colors, spacing, typography, radius, and shadows. JSON format with token category names pointing to source file references."`
   - metadata: `{ sizeHint: '2KB', lastUpdated: '2026-01-27', categories: ['colors', 'spacing', 'typography', 'radius', 'shadows'] }`

3. `mcellui://docs/getting-started`:
   - description: `"Quick start guide: initialize project, add components, basic usage. Covers CLI commands and project structure. (5-minute read)"`
   - metadata: `{ sizeHint: '2KB', lastUpdated: '2026-01-27', topics: ['installation', 'configuration', 'first-component', 'cli-commands'] }`

4. `mcellui://docs/component-patterns`:
   - description: `"Component architecture patterns: basic structure, forwardRef, pressable, compound components, and input patterns with full code examples."`
   - metadata: `{ sizeHint: '4KB', lastUpdated: '2026-01-27', topics: ['basic-component', 'forward-ref', 'pressable', 'compound-component', 'input-pattern'] }`

5. `mcellui://docs/theme-customization`:
   - description: `"Theme customization guide: presets, custom colors, spacing scale, radius scale, dark mode, and font configuration with code examples."`
   - metadata: `{ sizeHint: '5KB', lastUpdated: '2026-01-27', topics: ['presets', 'colors', 'spacing', 'radius', 'dark-mode', 'fonts'] }`

6. `mcellui://docs/animation-patterns`:
   - description: `"Reanimated 3 animation patterns: spring configs, press feedback, enter/exit, layout animations, gesture-driven, and performance tips."`
   - metadata: `{ sizeHint: '5KB', lastUpdated: '2026-01-27', topics: ['spring-config', 'press-feedback', 'enter-exit', 'layout', 'gesture', 'performance'] }`

7. `mcellui://docs/accessibility`:
   - description: `"Accessibility guide: VoiceOver/TalkBack patterns for buttons, forms, lists, modals, images, focus management, and testing checklist."`
   - metadata: `{ sizeHint: '6KB', lastUpdated: '2026-01-27', topics: ['voiceover', 'talkback', 'roles', 'labels', 'focus', 'testing'] }`
  </action>
  <verify>
Grep for `sizeHint` in resources/index.ts — should find 7 occurrences.
Grep for `lastUpdated` in resources/index.ts — should find 7 occurrences.
Grep for `metadata:` in resources/index.ts — should find 7 occurrences.
  </verify>
  <done>
All 7 resources have enriched descriptions and metadata with sizeHint, lastUpdated, and topic arrays.
  </done>
</task>

<task type="auto">
  <name>Task 2: Improve resource error handling</name>
  <files>packages/mcp-server/src/resources/index.ts</files>
  <action>
Update the `handleResourceRead` function with improved error handling:

**1. Registry load error** — include recovery hint:
Replace `'{"error": "Could not load registry"}'` with:
```
'{"error": "Could not load registry", "hint": "Check that the registry directory exists at the expected path or that the remote registry URL is reachable."}'
```

**2. Tokens load error** — include recovery hint:
Replace `'{"error": "Could not load tokens"}'` with:
```
'{"error": "Could not load tokens", "hint": "Token files may be missing from the core package. Ensure packages/core/src/tokens/ directory exists."}'
```

**3. Resource not found (default case)** — list available URIs:
Replace the default case with:
```typescript
default: {
  const availableUris = resources.map(r => r.uri).join(', ');
  return {
    contents: [{
      uri,
      text: `Resource not found: ${uri}\n\nAvailable resources: ${availableUris}`,
      mimeType: 'text/plain',
    }],
  };
}
```

This helps agents discover valid URIs when they request an invalid one.
  </action>
  <verify>
Grep for `"hint"` in resources/index.ts — should find 2 occurrences (registry, tokens).
Grep for `Available resources` in resources/index.ts — should find 1 occurrence.
Run `npx tsc --noEmit` from packages/mcp-server.
  </verify>
  <done>
Resource error responses include recovery hints. Resource not found lists available URIs. Requirement MCP-05 is satisfied.
  </done>
</task>

</tasks>

<verification>
- `grep -c "sizeHint" packages/mcp-server/src/resources/index.ts` returns 7
- `grep -c "metadata:" packages/mcp-server/src/resources/index.ts` returns 7
- `grep "Available resources" packages/mcp-server/src/resources/index.ts` finds the not-found handler
- `grep "hint" packages/mcp-server/src/resources/index.ts` finds recovery hints
- TypeScript compiles without errors
</verification>

<success_criteria>
All 7 resources have metadata (description, sizeHint, lastUpdated, topics). Error responses include recovery hints. Not-found lists available URIs. Requirement MCP-05 is fully satisfied.
</success_criteria>

<output>
After completion, create `.planning/phases/16-mcp-server-tool-quality/16-03-SUMMARY.md`
</output>
