---
phase: 02-buttons-actions
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - packages/registry/ui/fab.tsx
autonomous: true

must_haves:
  truths:
    - "FAB uses centralized tokens from components.fab[size]"
    - "FAB respects areAnimationsDisabled() for accessibility"
    - "FAB uses componentRadius.fab for border radius"
    - "FAB uses springs.snappy from theme instead of inline spring config"
  artifacts:
    - path: "packages/registry/ui/fab.tsx"
      provides: "Token-based FAB component"
      contains: "components.fab"
  key_links:
    - from: "packages/registry/ui/fab.tsx"
      to: "@metacells/mcellui-core"
      via: "import useTheme, areAnimationsDisabled"
      pattern: "areAnimationsDisabled"
---

<objective>
Migrate FAB to use centralized tokens and add missing accessibility features.

Purpose: Ensure FAB matches Button's gold standard patterns for consistency and accessibility
Output: Refactored FAB using components.fab tokens, componentRadius.fab, areAnimationsDisabled check, theme springs
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-buttons-actions/02-RESEARCH.md
@.planning/phases/02-buttons-actions/02-01-SUMMARY.md
@packages/registry/ui/button.tsx
@packages/registry/ui/fab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate FAB to use centralized tokens</name>
  <files>packages/registry/ui/fab.tsx</files>
  <action>
Refactor FAB to match Button's gold standard pattern:

1. **Update imports** - Add areAnimationsDisabled:
```typescript
import { useTheme, haptic, areAnimationsDisabled } from '@metacells/mcellui-core';
```

2. **Add useMemo import and animations check**:
```typescript
import React, { useMemo } from 'react';
// ... in component:
const animationsEnabled = useMemo(() => !areAnimationsDisabled(), []);
```

3. **Remove hardcoded SIZE_CONFIG** - Delete lines 78-97 (the SIZE_CONFIG object)

4. **Update useTheme destructuring** - Include components, componentRadius, springs:
```typescript
const { colors, components, componentRadius, fontWeight, platformShadow, springs } = useTheme();
const tokens = components.fab[size];
```

5. **Update handlePressIn** - Use theme springs and respect animations:
```typescript
const handlePressIn = () => {
  if (animationsEnabled) {
    scale.value = withSpring(0.92, springs.snappy);  // Keep 0.92 for FAB feel
  }
};
```

6. **Update handlePressOut** - Use theme springs and respect animations:
```typescript
const handlePressOut = () => {
  if (animationsEnabled) {
    scale.value = withSpring(1, springs.snappy);
  }
};
```

7. **Update animatedStyle** - Respect animations disabled:
```typescript
const animatedStyle = useAnimatedStyle(() => ({
  transform: [{ scale: animationsEnabled ? scale.value : 1 }],
}));
```

8. **Update style to use tokens**:
```typescript
style={[
  styles.fab,
  {
    backgroundColor: variantStyles.backgroundColor,
    width: isExtended ? 'auto' : tokens.size,
    height: tokens.size,
    borderRadius: tokens.size / 2,  // FAB is always circular, computed from size
    paddingHorizontal: isExtended ? tokens.paddingHorizontal : 0,
    opacity: disabled ? 0.5 : 1,
  },
  platformShadow('lg'),
  animatedStyle,
  style,
]}
```

9. **Update icon cloneElement to use tokens**:
```typescript
React.cloneElement(icon as React.ReactElement<...>, {
  width: tokens.iconSize,
  height: tokens.iconSize,
  color: variantStyles.iconColor,
})
```

10. **Update label Text to use tokens**:
```typescript
<Text
  style={[
    styles.label,
    {
      fontSize: tokens.fontSize,
      fontWeight: tokens.fontWeight,
      color: variantStyles.iconColor,
      marginLeft: 8,
    },
  ]}
>
  {label}
</Text>
```
  </action>
  <verify>
1. `npx tsc --noEmit -p packages/registry/tsconfig.json` passes
2. Start demo app and verify FAB demo works: all sizes (sm, md, lg) render correctly, extended FAB works, animations work
  </verify>
  <done>FAB uses centralized tokens, respects areAnimationsDisabled(), uses theme springs</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit -p packages/registry/tsconfig.json`
2. Demo verification: FAB renders at all 3 sizes (sm, md, lg), extended FAB with label works
3. Animation check: With iOS "Reduce Motion" enabled, animations should be disabled
4. Theme integration: FAB uses springs.snappy from theme
</verification>

<success_criteria>
- [ ] FAB imports areAnimationsDisabled from core
- [ ] FAB uses components.fab[size] for tokens
- [ ] FAB uses springs.snappy from theme (not inline { damping: 20, stiffness: 400 })
- [ ] FAB checks animationsEnabled before running animations
- [ ] Local SIZE_CONFIG removed
- [ ] TypeScript compilation passes
- [ ] Visual output unchanged (same sizes, same visual appearance)
</success_criteria>

<output>
After completion, create `.planning/phases/02-buttons-actions/02-03-SUMMARY.md`
</output>
