---
phase: 14-critical-package-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/registry/package.json
  - packages/cli/package.json
  - packages/mcp-server/package.json
autonomous: true

must_haves:
  truths:
    - "Tools can read package.json metadata from all packages"
    - "Users installing animated components get clear peer dependency requirements"
    - "npm install succeeds and animated components work after installing reanimated/gesture-handler"
  artifacts:
    - path: "packages/registry/package.json"
      provides: "Peer dependencies for animation libraries"
      contains: "react-native-reanimated"
    - path: "packages/cli/package.json"
      provides: "./package.json export"
      contains: "./package.json"
    - path: "packages/mcp-server/package.json"
      provides: "./package.json export"
      contains: "./package.json"
  key_links:
    - from: "packages/registry/package.json"
      to: "user project"
      via: "peerDependencies"
      pattern: '"react-native-reanimated"'
    - from: "packages/cli/package.json"
      to: "tooling"
      via: "./package.json export"
      pattern: '"\\./package\\.json":\\s*"\\./package\\.json"'
---

<objective>
Add peer dependencies to registry and ./package.json exports to remaining packages.

Purpose: Registry currently lacks peer dependency declarations for reanimated and gesture-handler, causing runtime crashes when users install animated components. CLI and MCP server lack ./package.json exports, breaking tooling that needs to read package metadata.

Output: Updated package.json files for registry, CLI, and MCP server.
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-critical-package-fixes/14-RESEARCH.md
@packages/registry/package.json
@packages/cli/package.json
@packages/mcp-server/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ./package.json exports to CLI and MCP server</name>
  <files>packages/cli/package.json, packages/mcp-server/package.json</files>
  <action>
Add ./package.json export to both packages:

**packages/cli/package.json:**
Add exports field (currently missing):
```json
"exports": {
  ".": {
    "types": "./dist/index.d.ts",
    "default": "./dist/index.js"
  },
  "./package.json": "./package.json"
}
```

**packages/mcp-server/package.json:**
Add exports field (currently missing):
```json
"exports": {
  ".": {
    "types": "./dist/index.d.ts",
    "default": "./dist/index.js"
  },
  "./package.json": "./package.json"
}
```

Note: Both packages already have main and types fields pointing to dist/. The exports field adds explicit subpath exports and the ./package.json export for tooling.

Also add "sideEffects": false to both packages.
  </action>
  <verify>
Both package.json files contain:
- exports["./package.json"]: "./package.json"
- exports["."].types: "./dist/index.d.ts"
- sideEffects: false
  </verify>
  <done>CLI and MCP server have ./package.json exports and sideEffects field</done>
</task>

<task type="auto">
  <name>Task 2: Add peer dependencies and ./package.json to registry</name>
  <files>packages/registry/package.json</files>
  <action>
Update packages/registry/package.json:

1. Add animation libraries to peerDependencies:
```json
"peerDependencies": {
  "react": ">=18.0.0",
  "react-native": ">=0.73.0",
  "react-hook-form": ">=7.50.0",
  "@hookform/resolvers": ">=3.3.0",
  "zod": ">=3.22.0",
  "react-native-reanimated": ">=3.0.0",
  "react-native-gesture-handler": ">=2.0.0"
}
```

2. Add peerDependenciesMeta for optional libraries:
```json
"peerDependenciesMeta": {
  "react-hook-form": {
    "optional": true
  },
  "@hookform/resolvers": {
    "optional": true
  },
  "zod": {
    "optional": true
  },
  "react-native-reanimated": {
    "optional": true
  },
  "react-native-gesture-handler": {
    "optional": true
  }
}
```

3. Add exports field with ./package.json:
```json
"exports": {
  "./package.json": "./package.json"
}
```

4. Add sideEffects field:
```json
"sideEffects": false
```

Rationale for optional:
- Users who only add static components (Badge, Label, Separator) don't need animation libraries
- Users who only add non-form components don't need form libraries
- Better UX: install only what you use
- CLI can detect which dependencies are needed per component
  </action>
  <verify>
Registry package.json contains:
- peerDependencies with react-native-reanimated and react-native-gesture-handler
- peerDependenciesMeta marking animation and form libraries as optional
- exports["./package.json"]: "./package.json"
- sideEffects: false
  </verify>
  <done>Registry has animation peer deps, optional meta, ./package.json export, and sideEffects field</done>
</task>

</tasks>

<verification>
1. Check packages/cli/package.json has exports with ./package.json
2. Check packages/mcp-server/package.json has exports with ./package.json
3. Check packages/registry/package.json has:
   - react-native-reanimated in peerDependencies
   - react-native-gesture-handler in peerDependencies
   - peerDependenciesMeta with optional: true for animation libs
   - exports["./package.json"]
4. Run `npm install` in monorepo root - should complete without peer dep warnings within the monorepo
</verification>

<success_criteria>
- All 3 packages have ./package.json exports for tooling compatibility
- Registry declares reanimated and gesture-handler as peer dependencies
- Animation and form libraries marked as optional in peerDependenciesMeta
- All packages have sideEffects: false for tree-shaking
</success_criteria>

<output>
After completion, create `.planning/phases/14-critical-package-fixes/14-02-SUMMARY.md`
</output>
