---
phase: 04-progress-loading
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - packages/registry/ui/spinner.tsx
  - packages/registry/ui/skeleton.tsx
autonomous: true

must_haves:
  truths:
    - "Spinner uses spinnerTokens for container and indicator sizes"
    - "Skeleton uses skeletonTokens for radius values and animation timing"
    - "No hardcoded size values remain in either component"
  artifacts:
    - path: "packages/registry/ui/spinner.tsx"
      provides: "Token-based Spinner component"
      contains: "spinnerTokens"
    - path: "packages/registry/ui/skeleton.tsx"
      provides: "Token-based Skeleton component"
      contains: "skeletonTokens"
  key_links:
    - from: "packages/registry/ui/spinner.tsx"
      to: "@metacells/mcellui-core"
      via: "import spinnerTokens"
      pattern: "import.*spinnerTokens.*from"
    - from: "packages/registry/ui/skeleton.tsx"
      to: "@metacells/mcellui-core"
      via: "import skeletonTokens"
      pattern: "import.*skeletonTokens.*from"
---

<objective>
Migrate Spinner and Skeleton components to use centralized tokens from the core theme system.

Purpose: Replace hardcoded magic numbers with theme-based tokens so sizing and animation timing is consistent and configurable.

Output: Updated Spinner and Skeleton components consuming tokens from @metacells/mcellui-core
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-progress-loading/04-RESEARCH.md
@packages/registry/ui/spinner.tsx
@packages/registry/ui/skeleton.tsx
@packages/core/src/theme/components.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Spinner to use spinnerTokens</name>
  <files>packages/registry/ui/spinner.tsx</files>
  <action>
Update Spinner component to consume centralized tokens:

1. Add import for spinnerTokens:
```typescript
import { useTheme, spinnerTokens } from '@metacells/mcellui-core';
```

2. Remove the hardcoded mappings:
- Delete `sizeMap` constant (lines 38-42)
- Delete `containerSizes` constant (lines 44-48)

3. Update component to use tokens:
```typescript
export function Spinner({
  size = 'md',
  color = 'default',
  style,
  ...props
}: SpinnerProps) {
  const { colors } = useTheme();
  const tokens = spinnerTokens[size];

  const getColor = (): string => {
    switch (color) {
      case 'primary':
        return colors.primary;
      case 'secondary':
        return colors.secondary;
      case 'muted':
        return colors.foregroundMuted;
      case 'default':
      default:
        return colors.foreground;
    }
  };

  return (
    <View
      style={[
        styles.container,
        {
          width: tokens.containerSize,
          height: tokens.containerSize,
        },
        style,
      ]}
      accessibilityRole="progressbar"
      accessibilityLabel="Loading"
      accessibilityState={{ busy: true }}
    >
      <ActivityIndicator
        size={tokens.indicatorSize}
        color={getColor()}
        {...props}
      />
    </View>
  );
}
```

Keep existing styles unchanged (just the container flexbox styles).
  </action>
  <verify>
Run `npx tsc --noEmit` in packages/registry to verify no TypeScript errors.
Grep for "spinnerTokens" in spinner.tsx to confirm import exists.
Verify no hardcoded 16, 24, or 36 values remain in the file.
  </verify>
  <done>
Spinner component uses spinnerTokens for containerSize and indicatorSize with no hardcoded size values.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate Skeleton to use skeletonTokens</name>
  <files>packages/registry/ui/skeleton.tsx</files>
  <action>
Update Skeleton component to consume centralized tokens:

1. Add import for skeletonTokens:
```typescript
import { useTheme, areAnimationsDisabled, skeletonTokens } from '@metacells/mcellui-core';
```

2. Remove the hardcoded radiusMap:
- Delete `radiusMap` constant (lines 46-52)

3. Update Skeleton component to use tokens for radius:
```typescript
const dimensions = circle
  ? { width: size, height: size, borderRadius: size / 2 }
  : {
      width,
      height,
      borderRadius: skeletonTokens.radius[radius],
    };
```

4. Update animation timing to use tokens:
```typescript
useEffect(() => {
  if (shouldAnimate) {
    shimmerProgress.value = withRepeat(
      withTiming(1, {
        duration: skeletonTokens.animation.duration,
        easing: Easing.inOut(Easing.ease),
      }),
      -1,
      false
    );
  }
}, [shouldAnimate]);

const animatedStyle = useAnimatedStyle(() => {
  const opacity = interpolate(
    shimmerProgress.value,
    [0, 0.5, 1],
    [skeletonTokens.animation.minOpacity, skeletonTokens.animation.maxOpacity, skeletonTokens.animation.minOpacity]
  );

  return {
    opacity: shouldAnimate ? opacity : skeletonTokens.animation.minOpacity,
  };
});
```

5. Update SkeletonText defaults to use tokens:
```typescript
export function SkeletonText({
  lines = skeletonTokens.text.defaultLines,
  gap = skeletonTokens.text.defaultGap,
  lastLineWidth = skeletonTokens.text.lastLineWidth,
  lineHeight = skeletonTokens.text.defaultLineHeight,
  style,
}: SkeletonTextProps) {
  // ... rest unchanged
}
```

Keep existing functionality - just replace hardcoded values with token references.
  </action>
  <verify>
Run `npx tsc --noEmit` in packages/registry to verify no TypeScript errors.
Grep for "skeletonTokens" in skeleton.tsx to confirm import exists.
Verify no hardcoded radius values (0, 4, 8, 12, 9999) remain outside token reference.
Verify no hardcoded 1500, 0.3, 0.6 values remain outside token reference.
  </verify>
  <done>
Skeleton component uses skeletonTokens for radius mapping, animation timing, and SkeletonText defaults with no hardcoded magic numbers.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `cd packages/registry && npx tsc --noEmit`
2. Token imports visible: grep for imports from @metacells/mcellui-core in both files
3. No hardcoded sizes: grep for magic numbers (16, 24, 36, 1500, 0.3, 0.6) should not appear as literals
4. Demo app runs: Start demo app and verify Spinner/Skeleton still render correctly
</verification>

<success_criteria>
- Spinner imports and uses spinnerTokens for all size variants
- Spinner has no hardcoded container or indicator size values
- Skeleton imports and uses skeletonTokens for radius and animation
- Skeleton animation uses token-based duration and opacity values
- SkeletonText uses token-based defaults for lines, gap, lineHeight
- Both components maintain existing accessibility props
</success_criteria>

<output>
After completion, create `.planning/phases/04-progress-loading/04-02-SUMMARY.md`
</output>
