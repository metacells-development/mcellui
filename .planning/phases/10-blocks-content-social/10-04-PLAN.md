# Plan 10-04: Swipeable Blocks Enhancement

```yaml
phase: 10-blocks-content-social
plan: 04
type: execute
wave: 2
depends_on:
  - 10-01
files_modified:
  - packages/registry/blocks/user-list-item.tsx
  - packages/registry/blocks/cart-item.tsx
autonomous: true

must_haves:
  truths:
    - "CartItem swipe actions show loading indicators when in progress"
    - "UserListItem action button shows loading state"
    - "Both blocks have accessibility labels on interactive elements"
  artifacts:
    - path: "packages/registry/blocks/user-list-item.tsx"
      provides: "UserListItem with loading and disabled props"
      contains: "socialBlockTokens"
    - path: "packages/registry/blocks/cart-item.tsx"
      provides: "CartItem with quantityLoading and removeLoading props"
      contains: "ecommerceBlockTokens"
  key_links:
    - from: "packages/registry/blocks/cart-item.tsx"
      to: "packages/registry/ui/swipeable-row.tsx"
      via: "SwipeableRow wrapper"
      pattern: "SwipeableRow"
```

<objective>
Enhance UserListItem and CartItem with proper token usage, loading states, and accessibility labels.

Purpose: Ensure swipeable blocks have consistent interaction states and accessible controls.
Output: Both blocks with loading/disabled props and token-based styling.
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-blocks-content-social/10-RESEARCH.md
@.planning/phases/10-blocks-content-social/10-01-SUMMARY.md
@packages/registry/blocks/user-list-item.tsx
@packages/registry/blocks/cart-item.tsx
</context>

<tasks>

<task type="auto">
  <name>Enhance UserListItem with token migration and loading states</name>
  <files>packages/registry/blocks/user-list-item.tsx</files>
  <action>
1. Read packages/registry/blocks/user-list-item.tsx
2. Import tokens: `import { socialBlockTokens, ecommerceBlockTokens } from '@metacells/mcellui-core'`
3. Verify actionLoading prop exists and is properly used
4. Add disabled prop if missing
5. Update action button to:
   - Use Button loading prop for loading state
   - Disable when disabled or actionLoading
   - Add accessibilityLabel describing action and user name
6. Migrate typography to socialBlockTokens:
   - Name: socialBlockTokens.typography.authorFontSize
   - Subtitle: fontSize.sm
7. Avatar size: socialBlockTokens.avatar.listSize ('md')
8. Add accessibility labels:
   - Container accessibilityLabel with user name and username
   - accessibilityRole="button" if onPress provided
9. Optional: Add swipeActions prop type for future swipe action support
  </action>
  <verify>
cd /Users/johanneschristler/Code/metacells/other/mcellui
grep -n "socialBlockTokens" packages/registry/blocks/user-list-item.tsx
grep -n "actionLoading\|disabled" packages/registry/blocks/user-list-item.tsx
grep -n "accessibilityLabel" packages/registry/blocks/user-list-item.tsx | head -5
npx tsc --noEmit -p packages/registry/tsconfig.json
  </verify>
  <done>
- UserListItem imports and uses socialBlockTokens
- actionLoading prop properly controls Button loading state
- disabled prop disables all interactions
- Accessibility labels on container and action button
  </done>
</task>

<task type="auto">
  <name>Enhance CartItem with token migration and interaction states</name>
  <files>packages/registry/blocks/cart-item.tsx</files>
  <action>
1. Read packages/registry/blocks/cart-item.tsx
2. Import tokens: `import { cardBlockTokens, ecommerceBlockTokens } from '@metacells/mcellui-core'`
3. Add loading and disabled props:
   - quantityLoading?: boolean
   - removeLoading?: boolean
   - disabled?: boolean
4. Update Stepper to use loading/disabled:
   - Pass loading={quantityLoading}
   - Pass disabled={disabled || quantityLoading}
   - size={ecommerceBlockTokens.cart.stepperSize}
5. Migrate to tokens:
   - Image size: ecommerceBlockTokens.cart.imageSize (80)
   - Swipe action width: ecommerceBlockTokens.cart.swipeActionWidth (80)
   - Padding: cardBlockTokens.content.paddingHorizontal/paddingVertical
6. Add loading state to swipe actions:
   - Show ActivityIndicator when saveLoading or removeLoading
   - Disable action when disabled prop is true
7. Add accessibility:
   - Product name: accessibilityRole="text"
   - Container: accessibilityLabel describing product and quantity
  </action>
  <verify>
cd /Users/johanneschristler/Code/metacells/other/mcellui
grep -n "ecommerceBlockTokens" packages/registry/blocks/cart-item.tsx
grep -n "quantityLoading\|removeLoading\|disabled" packages/registry/blocks/cart-item.tsx
grep -n "Stepper" packages/registry/blocks/cart-item.tsx -A 10
npx tsc --noEmit -p packages/registry/tsconfig.json
  </verify>
  <done>
- CartItem imports and uses ecommerceBlockTokens and cardBlockTokens
- quantityLoading, removeLoading, disabled props work correctly
- Stepper uses ecommerceBlockTokens.cart.stepperSize
- Swipe actions show loading indicators when in progress
- Accessibility labels on product and container
  </done>
</task>

</tasks>

<verification>
```bash
cd /Users/johanneschristler/Code/metacells/other/mcellui

# Check token imports
grep -l "ecommerceBlockTokens\|socialBlockTokens" packages/registry/blocks/{user-list-item,cart-item}.tsx

# Verify loading props exist
grep -n "Loading\?:" packages/registry/blocks/{user-list-item,cart-item}.tsx

# Verify disabled props exist
grep -n "disabled\?:" packages/registry/blocks/{user-list-item,cart-item}.tsx

# Verify accessibility labels
grep -n "accessibilityLabel\|accessibilityRole" packages/registry/blocks/{user-list-item,cart-item}.tsx | head -10

# Check Stepper disabled prop usage
grep -n "Stepper" packages/registry/blocks/cart-item.tsx -A 10

# TypeScript compilation
npx tsc --noEmit -p packages/registry/tsconfig.json
```
</verification>

<success_criteria>
- [ ] CartItem maintains working SwipeableRow integration
- [ ] CartItem swipe actions show loading indicators when in progress
- [ ] CartItem Stepper uses ecommerceBlockTokens.cart.stepperSize
- [ ] UserListItem has actionLoading prop working with Button loading state
- [ ] UserListItem has disabled prop that disables all interactions
- [ ] Both blocks use consistent spacing from tokens
- [ ] Both blocks have accessibility labels on interactive elements
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-blocks-content-social/10-04-SUMMARY.md`
</output>
