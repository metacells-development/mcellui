---
phase: 19-critical-color-api-fixes
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/registry/blocks/hero-block.tsx
  - packages/registry/blocks/review-card-block.tsx
  - packages/registry/blocks/feed-post-card-block.tsx
  - packages/registry/blocks/pricing-card-block.tsx
  - packages/registry/blocks/banner-block.tsx
  - packages/registry/blocks/product-card-block.tsx
  - packages/registry/blocks/article-card-block.tsx
  - packages/registry/blocks/chat-bubble-block.tsx
  - packages/registry/blocks/task-item-block.tsx
  - packages/registry/blocks/event-card-block.tsx
  - packages/registry/blocks/media-item-block.tsx
  - packages/registry/blocks/cart-item-block.tsx
  - packages/registry/blocks/comment-item-block.tsx
  - packages/registry/blocks/search-header-block.tsx
  - packages/registry/blocks/order-item-block.tsx
autonomous: true

must_haves:
  truths:
    - "All icon defaults in block files use colors.foreground instead of #000"
    - "All RGBA overlays in block files use colors.overlay or colors.scrim"
    - "All hardcoded hex colors in blocks use semantic tokens (except intentional brand colors)"
    - "Hero block gradient presets remain unchanged (intentional artistic choice)"
  artifacts:
    - path: "packages/registry/blocks/task-item-block.tsx"
      provides: "Semantic priority colors"
      contains: "colors.success"
    - path: "packages/registry/blocks/banner-block.tsx"
      provides: "Semantic overlay color"
      contains: "colors.scrim"
    - path: "packages/registry/blocks/product-card-block.tsx"
      provides: "Semantic overlay color"
      contains: "colors.overlay"
  key_links:
    - from: "packages/registry/blocks/*.tsx"
      to: "@metacells/mcellui-core"
      via: "useTheme() hook"
      pattern: "const \\{ colors \\} = useTheme"
---

<objective>
Fix all hardcoded colors (icon defaults, RGBA overlays, hex values) in block components.

Purpose: Block templates are copy-pasted by users into their apps. Hardcoded colors break dark mode and theming. Every block must use semantic tokens so users get automatic theme support.

Output: 15 block files with all hardcoded colors replaced by semantic tokens.
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-critical-color-api-fixes/19-RESEARCH.md

Key reference:
@packages/core/src/theme/colors.ts (semantic color tokens)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix icon defaults and overlays in block components (Part A: overlay-heavy blocks)</name>
  <files>
    packages/registry/blocks/hero-block.tsx
    packages/registry/blocks/banner-block.tsx
    packages/registry/blocks/product-card-block.tsx
    packages/registry/blocks/article-card-block.tsx
    packages/registry/blocks/media-item-block.tsx
    packages/registry/blocks/review-card-block.tsx
    packages/registry/blocks/chat-bubble-block.tsx
  </files>
  <action>
For EACH of these 7 block files, apply three categories of fixes:

**A) Icon defaults (#000 → colors.foreground):**
Find all inline icon function components with `color = '#000'` default. Apply the same pattern as UI components:
```tsx
// BEFORE
function SomeIcon({ size = 24, color = '#000' }: { size?: number; color?: string }) {
// AFTER
function SomeIcon({ size = 24, color }: { size?: number; color?: string }) {
  const { colors } = useTheme();
  const finalColor = color ?? colors.foreground;
```
If the icon is defined inside a component that already has `const { colors } = useTheme()`, reuse that `colors` object instead of calling useTheme() again.

**B) RGBA overlays → semantic tokens:**
- `rgba(0,0,0,0.5)` → `colors.overlay` (full backdrop)
- `rgba(0,0,0,0.3)` or `rgba(0,0,0,0.4)` → `colors.scrim` (subtle/medium overlay)
- `rgba(255,255,255,0.7)` → `colors.background` (light surface, e.g. chat bubbles)
- `rgba(255,255,255,0.8)` → `colors.primaryForeground` (text on dark images)

**C) Hardcoded hex text colors:**
- `#fff` or `#ffffff` on colored backgrounds → `colors.primaryForeground`
- `#000` for text → `colors.foreground`

**IMPORTANT EXCEPTION — hero-block.tsx:**
- DO NOT change gradient preset colors (ocean, sunset, forest, etc. — these are artistic presets)
- DO change any rgba overlay values in hero-block.tsx (e.g., `rgba(0,0,0,0.4)` over gradient backgrounds → `colors.scrim`)
- DO change any #fff/#000 text/icon defaults in hero-block.tsx
  </action>
  <verify>
Run: `grep -rn "color = '#000'" packages/registry/blocks/hero-block.tsx packages/registry/blocks/banner-block.tsx packages/registry/blocks/product-card-block.tsx packages/registry/blocks/article-card-block.tsx packages/registry/blocks/media-item-block.tsx packages/registry/blocks/review-card-block.tsx packages/registry/blocks/chat-bubble-block.tsx`
Expected: Zero matches.

Run: `grep -c "rgba(" packages/registry/blocks/banner-block.tsx packages/registry/blocks/product-card-block.tsx packages/registry/blocks/article-card-block.tsx packages/registry/blocks/media-item-block.tsx packages/registry/blocks/review-card-block.tsx packages/registry/blocks/chat-bubble-block.tsx`
Expected: Zero or near-zero matches (hero-block may retain rgba in gradient definitions — that's OK).
  </verify>
  <done>All 7 overlay-heavy block files use semantic color tokens for icons, overlays, and text. Hero block gradient presets remain unchanged.</done>
</task>

<task type="auto">
  <name>Task 2: Fix icon defaults and hex colors in remaining block components</name>
  <files>
    packages/registry/blocks/feed-post-card-block.tsx
    packages/registry/blocks/pricing-card-block.tsx
    packages/registry/blocks/task-item-block.tsx
    packages/registry/blocks/event-card-block.tsx
    packages/registry/blocks/cart-item-block.tsx
    packages/registry/blocks/comment-item-block.tsx
    packages/registry/blocks/search-header-block.tsx
    packages/registry/blocks/order-item-block.tsx
  </files>
  <action>
For EACH of these 8 block files, apply the same three categories of fixes:

**A) Icon defaults:** Same pattern as Task 1 — replace `color = '#000'` with `color ?? colors.foreground`.

**B) RGBA overlays:** Same mapping as Task 1.

**C) Hardcoded hex colors — special cases:**

1. **task-item-block.tsx** — Replace priority indicator colors:
   - `#10b981` (green, low priority) → `colors.success`
   - `#f59e0b` (amber, medium priority) → `colors.warning`
   - `#ef4444` (red, high priority) → `colors.destructive`
   These semantic tokens match the exact visual intent.

2. **All files** — Replace any `#fff`/`#ffffff`/`#000` text colors:
   - White text on colored bg → `colors.primaryForeground`
   - Black text → `colors.foreground`
   - Muted/gray text → `colors.foregroundMuted`

**Important:**
- Ensure `useTheme` import exists in each file
- Ensure `colors` is destructured from `useTheme()` call
- If a file already uses `useTheme()`, add missing tokens to destructuring
  </action>
  <verify>
Run: `grep -rn "color = '#000'" packages/registry/blocks/feed-post-card-block.tsx packages/registry/blocks/pricing-card-block.tsx packages/registry/blocks/task-item-block.tsx packages/registry/blocks/event-card-block.tsx packages/registry/blocks/cart-item-block.tsx packages/registry/blocks/comment-item-block.tsx packages/registry/blocks/search-header-block.tsx packages/registry/blocks/order-item-block.tsx`
Expected: Zero matches.

Run: `grep -n "'#10b981'\|'#f59e0b'\|'#ef4444'" packages/registry/blocks/task-item-block.tsx`
Expected: Zero matches (replaced with semantic tokens).

Run: `grep -rn "colors.success\|colors.warning\|colors.destructive" packages/registry/blocks/task-item-block.tsx`
Expected: 3 matches (one per priority level).
  </verify>
  <done>All 8 remaining block files use semantic color tokens. task-item-block priority colors use success/warning/destructive tokens. No hardcoded hex/rgba values remain.</done>
</task>

</tasks>

<verification>
1. `grep -rn "color = '#000'" packages/registry/blocks/` → 0 matches
2. `grep -rn "'#10b981'\|'#f59e0b'\|'#ef4444'" packages/registry/blocks/task-item-block.tsx` → 0 matches
3. `grep -rn "rgba(" packages/registry/blocks/` → Only hero-block gradient presets (if any remain)
4. Hero block gradient preset colors (ocean, sunset, etc.) are unchanged
</verification>

<success_criteria>
- Zero `color = '#000'` icon defaults across all 15 block files
- Zero hardcoded RGBA overlay values (except hero-block gradient presets)
- Zero hardcoded priority hex colors in task-item-block
- All blocks use semantic tokens from useTheme()
- Hero block gradient presets remain unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/19-critical-color-api-fixes/19-03-SUMMARY.md`
</output>
