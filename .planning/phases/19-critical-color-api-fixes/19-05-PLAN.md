---
phase: 19-critical-color-api-fixes
plan: 05
type: execute
wave: 2
depends_on: ["19-01", "19-02", "19-03", "19-04"]
files_modified:
  - packages/core/src/theme/components.ts
  - packages/registry/ui/avatar.tsx
  - packages/registry/screens/home-screen.tsx
autonomous: true

must_haves:
  truths:
    - "Avatar component only accepts sm|md|lg sizes — xs and xl are removed"
    - "Avatar tokens in core only define sm|md|lg — no xs or xl entries"
    - "Home screen featured items section uses MediaCard component instead of manual card construction"
    - "All files that reference Avatar size='xs' or size='xl' are updated"
  artifacts:
    - path: "packages/core/src/theme/components.ts"
      provides: "3-size avatar tokens"
      contains: "sm.*md.*lg"
    - path: "packages/registry/ui/avatar.tsx"
      provides: "Standard AvatarSize type"
      contains: "type AvatarSize = 'sm' | 'md' | 'lg'"
    - path: "packages/registry/screens/home-screen.tsx"
      provides: "MediaCard usage for featured items"
      contains: "MediaCard"
  key_links:
    - from: "packages/registry/ui/avatar.tsx"
      to: "packages/core/src/theme/components.ts"
      via: "avatarTokens import"
      pattern: "avatarTokens"
    - from: "packages/registry/screens/home-screen.tsx"
      to: "packages/registry/ui/card.tsx"
      via: "MediaCard import"
      pattern: "import.*MediaCard.*from"
---

<objective>
Standardize Avatar API to sm|md|lg and refactor Home screen to use MediaCard component.

Purpose: Avatar is the only component with a 5-size scale (xs|sm|md|lg|xl) while all others use 3-size (sm|md|lg). This inconsistency confuses developers. The Home screen manually constructs cards when a reusable MediaCard component exists.

Output: Avatar component with standard 3-size API + Home screen using MediaCard for featured items.
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-critical-color-api-fixes/19-RESEARCH.md

Key reference files:
@packages/core/src/theme/components.ts (avatarTokens definition)
@packages/registry/ui/avatar.tsx (Avatar component)
@packages/registry/ui/card.tsx (MediaCard component — lines 446+)
@packages/registry/screens/home-screen.tsx (manual card construction — lines 330-372)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Standardize Avatar to sm|md|lg size scale</name>
  <files>
    packages/core/src/theme/components.ts
    packages/registry/ui/avatar.tsx
  </files>
  <action>
**Step 1: Update avatar tokens in core (components.ts lines ~341-367):**

Remove `xs` and `xl` entries from `avatarTokens`:
```typescript
// BEFORE
export const avatarTokens = {
  xs: { size: 24, fontSize: fontSize['2xs'], fontWeight: fontWeight.semibold },
  sm: { size: 32, fontSize: fontSize.xs, fontWeight: fontWeight.semibold },
  md: { size: 40, fontSize: fontSize.base, fontWeight: fontWeight.semibold },
  lg: { size: 56, fontSize: fontSize.xl, fontWeight: fontWeight.semibold },
  xl: { size: 80, fontSize: fontSize['2xl'], fontWeight: fontWeight.semibold },
}

// AFTER
export const avatarTokens = {
  sm: { size: 32, fontSize: fontSize.xs, fontWeight: fontWeight.semibold },
  md: { size: 40, fontSize: fontSize.base, fontWeight: fontWeight.semibold },
  lg: { size: 56, fontSize: fontSize.xl, fontWeight: fontWeight.semibold },
}
```

**Step 2: Update Avatar type in avatar.tsx (line ~29):**
```typescript
// BEFORE
export type AvatarSize = 'xs' | 'sm' | 'md' | 'lg' | 'xl';

// AFTER
export type AvatarSize = 'sm' | 'md' | 'lg';
```

**Step 3: Search for and update any usages of size="xs" or size="xl" across the entire registry:**
```bash
grep -rn "size=\"xs\"\|size='xs'\|size=\"xl\"\|size='xl'" packages/registry/
```
For each match:
- `size="xs"` → `size="sm"` (nearest equivalent)
- `size="xl"` → `size="lg"` (nearest equivalent)

Also check for dynamic size assignments:
```bash
grep -rn "AvatarSize\|avatarTokens" packages/registry/
```

**Important:**
- The default size is `md` — this remains unchanged
- If avatarTokens type is exported separately, update that too
- Check if AvatarGroup/AvatarStack references specific sizes
  </action>
  <verify>
Run: `grep -rn "'xs'\|'xl'" packages/core/src/theme/components.ts | grep -i avatar`
Expected: Zero matches (xs and xl removed from avatar tokens).

Run: `grep -n "AvatarSize" packages/registry/ui/avatar.tsx`
Expected: Shows `'sm' | 'md' | 'lg'` only.

Run: `grep -rn "size=\"xs\"\|size='xs'\|size=\"xl\"\|size='xl'" packages/registry/`
Expected: Zero matches related to Avatar.
  </verify>
  <done>Avatar component and tokens use standard sm|md|lg scale. No xs or xl references remain in the registry. Breaking change documented in code via type definition.</done>
</task>

<task type="auto">
  <name>Task 2: Refactor Home screen to use MediaCard component</name>
  <files>
    packages/registry/screens/home-screen.tsx
    packages/registry/ui/card.tsx
  </files>
  <action>
Replace the manual card construction in home-screen.tsx (lines ~330-372) with the existing `MediaCard` component from `card.tsx`.

**Step 1: Add MediaCard import at top of file:**
```tsx
import { MediaCard } from '../ui/card';
```
Check the exact export name and path. The card.tsx file should export `MediaCard`.

**Step 2: Check FeaturedItem type (lines ~82-87):**
The current type likely has:
```typescript
export interface FeaturedItem {
  id: string;
  title: string;
  subtitle?: string;
}
```
Add an optional `image` field if not present:
```typescript
export interface FeaturedItem {
  id: string;
  title: string;
  subtitle?: string;
  image?: ImageSourcePropType;
}
```
Import `ImageSourcePropType` from `react-native` if needed.

**Step 3: Replace manual card construction (lines ~330-372):**

Find the `featuredItems.map()` block that renders manual `<Pressable><View>...` cards and replace with:

```tsx
{featuredItems.map((item) => (
  <MediaCard
    key={item.id}
    source={item.image ?? { uri: '' }}
    title={item.title}
    description={item.subtitle}
    height={90}
    onPress={onFeaturedItemPress ? () => onFeaturedItemPress(item.id) : undefined}
    style={{ width: 140 }}
  />
))}
```

**Step 4: Verify MediaCard props match:**
Read `card.tsx` to confirm the exact props. If MediaCard doesn't accept `description` but uses `subtitle`, adapt accordingly. If MediaCard requires `source` (non-optional), make sure the fallback `{ uri: '' }` works, or add a check.

**Important:**
- Preserve the `key={item.id}` prop
- Preserve the `onFeaturedItemPress` callback
- Preserve the 140px width and 90px height
- The horizontal ScrollView wrapper around the map should remain unchanged
- Remove any now-unused styles related to the old manual card construction
- If MediaCard's API doesn't perfectly match (e.g., it doesn't support `description`), use the best available prop. Check the actual MediaCardProps interface.

**Note:** home-screen.tsx was already processed by Plan 04 for icon/color fixes. This plan only touches the featured items section (lines ~330-372) and the FeaturedItem type. There should be no conflict.
  </action>
  <verify>
Run: `grep -n "MediaCard" packages/registry/screens/home-screen.tsx`
Expected: At least 2 matches (import + usage).

Run: `grep -n "from '../ui/card'" packages/registry/screens/home-screen.tsx`
Expected: 1 match showing MediaCard import with correct path.

Run: `grep -c "Pressable" packages/registry/screens/home-screen.tsx`
Expected: Count should be lower than before (removed manual Pressable wrapping of cards). Note: other Pressable usages in the file for other sections are fine.

Verify no TypeScript errors: `cd packages/registry && npx tsc --noEmit 2>&1 | head -20` (or check for errors in home-screen.tsx specifically)
  </verify>
  <done>Home screen featured items section uses MediaCard component. Manual card construction (40+ lines) replaced with ~10 lines using MediaCard. FeaturedItem type includes optional image field.</done>
</task>

</tasks>

<verification>
1. Avatar type is `'sm' | 'md' | 'lg'` — no xs or xl
2. avatarTokens has exactly 3 entries (sm, md, lg)
3. No `size="xs"` or `size="xl"` Avatar usage in registry
4. Home screen imports and uses MediaCard
5. Home screen no longer has manual card construction in featured items
6. FeaturedItem type includes optional image field
</verification>

<success_criteria>
- Avatar AvatarSize type is exactly `'sm' | 'md' | 'lg'`
- avatarTokens object has exactly 3 keys: sm, md, lg
- All Avatar size="xs" and size="xl" references updated to sm/lg
- Home screen uses MediaCard for featured items
- No manual card View/Pressable construction in featured items section
- TypeScript compiles without new errors
</success_criteria>

<output>
After completion, create `.planning/phases/19-critical-color-api-fixes/19-05-SUMMARY.md`
</output>
