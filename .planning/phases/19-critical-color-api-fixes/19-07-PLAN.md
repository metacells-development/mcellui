---
phase: 19-critical-color-api-fixes
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/registry/ui/datetime-picker.tsx
  - packages/registry/ui/action-sheet.tsx
  - packages/registry/ui/image-gallery.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All overlay/backdrop colors use colors.overlay instead of rgba(0,0,0,0.5)"
    - "Dark mode overlays adapt to theme colors"
  artifacts:
    - path: "packages/registry/ui/datetime-picker.tsx"
      provides: "Theme-aware overlay"
      contains: "colors.overlay"
    - path: "packages/registry/ui/action-sheet.tsx"
      provides: "Theme-aware backdrop"
      contains: "colors.overlay"
    - path: "packages/registry/ui/image-gallery.tsx"
      provides: "Theme-aware fullscreen backdrop"
      contains: "colors.scrim"
  key_links:
    - from: "backdrop/overlay styles"
      to: "useTheme()"
      via: "inline backgroundColor style"
      pattern: "backgroundColor: colors\\.(overlay|scrim)"
---

<objective>
Fix overlay/backdrop colors in packages/registry/ui/ to use semantic color tokens instead of hardcoded rgba values.

Purpose: Gaps from VERIFICATION.md show 3 components use hardcoded rgba(0,0,0,0.5) which doesn't adapt to dark mode or theme customization.

Output: 3 UI components with theme-aware overlay colors.
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-critical-color-api-fixes/19-VERIFICATION.md

# Reference implementation (correct patterns)
@packages/mcp-server/registry/ui/action-sheet.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix datetime-picker overlay</name>
  <files>packages/registry/ui/datetime-picker.tsx</files>
  <action>
Find the modal backdrop style (around line 540) with hardcoded rgba(0,0,0,0.5).

BEFORE (in StyleSheet.create):
```tsx
modalBackdrop: {
  ...StyleSheet.absoluteFillObject,
  backgroundColor: 'rgba(0, 0, 0, 0.5)',
},
```

AFTER (in StyleSheet.create):
```tsx
modalBackdrop: {
  ...StyleSheet.absoluteFillObject,
  // backgroundColor moved to inline style for theme support
},
```

Then add inline backgroundColor where the style is used:
```tsx
<Animated.View style={[styles.modalBackdrop, { backgroundColor: colors.overlay }, backdropStyle]}>
```

Ensure colors is destructured from useTheme() in the component.
  </action>
  <verify>
Run: `grep -n "rgba(0, 0, 0" packages/registry/ui/datetime-picker.tsx`
Expected: No matches for backdrop (may have other uses like gradients)

Run: `grep -n "colors.overlay" packages/registry/ui/datetime-picker.tsx`
Expected: At least 1 match
  </verify>
  <done>datetime-picker overlay uses colors.overlay token</done>
</task>

<task type="auto">
  <name>Task 2: Fix action-sheet backdrop</name>
  <files>packages/registry/ui/action-sheet.tsx</files>
  <action>
Find the backdrop style (around line 364) with hardcoded rgba(0,0,0,0.5).

BEFORE (in StyleSheet.create):
```tsx
backdrop: {
  ...StyleSheet.absoluteFillObject,
  backgroundColor: 'rgba(0, 0, 0, 0.5)',
},
```

AFTER (in StyleSheet.create):
```tsx
backdrop: {
  ...StyleSheet.absoluteFillObject,
},
```

The component already has an Animated.View for the backdrop - add inline backgroundColor:
```tsx
<Animated.View style={[styles.backdrop, { backgroundColor: colors.overlay }, backdropStyle]}>
```

Ensure colors is destructured from useTheme().
  </action>
  <verify>
Run: `grep -n "rgba(0, 0, 0, 0.5)" packages/registry/ui/action-sheet.tsx`
Expected: No matches

Run: `grep -n "colors.overlay" packages/registry/ui/action-sheet.tsx`
Expected: At least 1 match
  </verify>
  <done>action-sheet backdrop uses colors.overlay token</done>
</task>

<task type="auto">
  <name>Task 3: Fix image-gallery fullscreen backdrop</name>
  <files>packages/registry/ui/image-gallery.tsx</files>
  <action>
Find the fullscreen backdrop (around line 252) using rgba(0,0,0,...) with opacity token.

The image-gallery uses a special opacity token for fullscreen mode. Change to use colors.scrim (for fullscreen dark backgrounds):

BEFORE:
```tsx
<Animated.View style={[styles.fullscreenBackdrop, { backgroundColor: `rgba(0, 0, 0, ${tokens.fullscreen.backdropOpacity})` }, backdropStyle]}>
```

AFTER:
```tsx
<Animated.View style={[styles.fullscreenBackdrop, { backgroundColor: colors.scrim }, backdropStyle]}>
```

Note: colors.scrim is the semantic token for fullscreen dark overlays (typically near-opaque black/dark). If not available, use colors.overlay.

Ensure colors is destructured from useTheme().
  </action>
  <verify>
Run: `grep -n "rgba(0, 0, 0" packages/registry/ui/image-gallery.tsx`
Expected: No matches in fullscreen backdrop

Run: `grep -n "colors.scrim\|colors.overlay" packages/registry/ui/image-gallery.tsx`
Expected: At least 1 match
  </verify>
  <done>image-gallery fullscreen backdrop uses semantic color token</done>
</task>

</tasks>

<verification>
```bash
# Verify no hardcoded overlay colors remain
grep -rn "rgba(0, 0, 0, 0.5)" packages/registry/ui/datetime-picker.tsx packages/registry/ui/action-sheet.tsx
# Expected: empty

# Verify theme colors used
grep -c "colors.overlay\|colors.scrim" packages/registry/ui/datetime-picker.tsx packages/registry/ui/action-sheet.tsx packages/registry/ui/image-gallery.tsx
# Expected: counts > 0 for each file

# TypeScript check
cd packages/registry && npx tsc --noEmit
# Expected: no errors in modified files
```
</verification>

<success_criteria>
1. grep for `rgba(0, 0, 0, 0.5)` in datetime-picker and action-sheet returns empty
2. grep for `colors.overlay` or `colors.scrim` shows usage in all 3 files
3. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/19-critical-color-api-fixes/19-07-SUMMARY.md`
</output>
