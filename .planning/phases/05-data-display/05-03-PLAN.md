---
phase: 05-data-display
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - packages/registry/ui/rating.tsx
  - packages/registry/ui/avatar-stack.tsx
autonomous: true

must_haves:
  truths:
    - "Rating component uses components.rating tokens instead of inline SIZE_CONFIG"
    - "AvatarStack component uses components.avatarStack tokens instead of inline SIZE_CONFIG"
    - "Both components maintain existing visual appearance"
  artifacts:
    - path: "packages/registry/ui/rating.tsx"
      provides: "Rating component with token-based sizing"
      contains: "components.rating"
    - path: "packages/registry/ui/avatar-stack.tsx"
      provides: "AvatarStack component with token-based sizing"
      contains: "components.avatarStack"
  key_links:
    - from: "packages/registry/ui/rating.tsx"
      to: "useTheme()"
      via: "token lookup"
      pattern: "const tokens = components\\.rating\\[size\\]"
    - from: "packages/registry/ui/avatar-stack.tsx"
      to: "useTheme()"
      via: "token lookup"
      pattern: "const tokens = components\\.avatarStack\\[size\\]"
---

<objective>
Migrate Rating and AvatarStack components to use centralized tokens from components.ts.

Purpose: Replace inline SIZE_CONFIG objects with theme token lookups so these components respect global theme settings and maintain consistency with other data display components.

Output: Rating and AvatarStack components consuming tokens via useTheme().components.
</objective>

<execution_context>
@/Users/johanneschristler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/johanneschristler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-data-display/05-RESEARCH.md
@.planning/phases/05-data-display/05-01-SUMMARY.md

@packages/registry/ui/rating.tsx
@packages/registry/ui/avatar-stack.tsx
@packages/core/src/theme/components.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Rating to centralized tokens</name>
  <files>packages/registry/ui/rating.tsx</files>
  <action>
1. Remove the inline SIZE_CONFIG object (lines ~76-89):
```typescript
// DELETE THIS:
const SIZE_CONFIG = {
  sm: { starSize: 18, gap: 2 },
  md: { starSize: 26, gap: 4 },
  lg: { starSize: 34, gap: 6 },
};
```

2. Update useTheme destructuring in Rating component to include components:
```typescript
const { colors, components } = useTheme();
```

3. Replace config lookup with token lookup:
```typescript
const tokens = components.rating[size];
```

4. Update style references:
- `config.starSize` -> `tokens.starSize`
- `config.gap` -> `tokens.gap`

5. These values are passed to the Star subcomponent as props - ensure size prop still receives tokens.starSize.

6. In the container style:
```typescript
<View style={[styles.container, { gap: tokens.gap }, style]}>
```

Note: The star animation logic, half-star rendering, and press handlers remain unchanged. Only the size lookup changes.
  </action>
  <verify>
Run `npx tsc --noEmit -p packages/registry` - no type errors.
Grep for token usage: `grep "components.rating" packages/registry/ui/rating.tsx`
Grep removed SIZE_CONFIG: `grep "SIZE_CONFIG" packages/registry/ui/rating.tsx` should find nothing.
  </verify>
  <done>
Rating component uses components.rating[size] tokens for starSize and gap; no inline SIZE_CONFIG exists.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate AvatarStack to centralized tokens</name>
  <files>packages/registry/ui/avatar-stack.tsx</files>
  <action>
1. Remove the inline SIZE_CONFIG object (lines ~75-96):
```typescript
// DELETE THIS:
const SIZE_CONFIG = {
  sm: { size: 28, fontSize: 10, borderWidth: 2 },
  md: { size: 36, fontSize: 12, borderWidth: 2 },
  lg: { size: 44, fontSize: 14, borderWidth: 3 },
  xl: { size: 56, fontSize: 18, borderWidth: 3 },
};
```

2. Update useTheme destructuring to include components:
```typescript
const { colors, fontWeight, components } = useTheme();
```

3. Replace config lookup with token lookup:
```typescript
const tokens = components.avatarStack[size];
```

4. Update all style references:
- `config.size` -> `tokens.size`
- `config.fontSize` -> `tokens.fontSize`
- `config.borderWidth` -> `tokens.borderWidth`

5. These appear in multiple places:
- Avatar wrapper: width, height, borderRadius (size/2), borderWidth
- Avatar image: width/height (size - borderWidth*2), borderRadius
- Avatar fallback: same as image
- Initials text: fontSize
- Overflow badge: same dimensions as avatar

6. Verify fontWeight still comes from theme: `fontWeight.semibold`

Note: The getInitials(), stringToColor() helper functions and overlap calculation logic remain unchanged.
  </action>
  <verify>
Run `npx tsc --noEmit -p packages/registry` - no type errors.
Grep for token usage: `grep "components.avatarStack" packages/registry/ui/avatar-stack.tsx`
Grep removed SIZE_CONFIG: `grep "SIZE_CONFIG" packages/registry/ui/avatar-stack.tsx` should find nothing.
  </verify>
  <done>
AvatarStack component uses components.avatarStack[size] tokens for size, fontSize, borderWidth; no inline SIZE_CONFIG exists.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. `npx tsc --noEmit -p packages/registry` passes without errors
2. Rating uses components.rating tokens - no SIZE_CONFIG
3. AvatarStack uses components.avatarStack tokens - no SIZE_CONFIG
4. Both compile and maintain existing visual behavior
</verification>

<success_criteria>
- Rating component: `const tokens = components.rating[size]` pattern
- No SIZE_CONFIG in rating.tsx
- AvatarStack component: `const tokens = components.avatarStack[size]` pattern
- No SIZE_CONFIG in avatar-stack.tsx
- Both components maintain same visual appearance (token values match original hardcoded values)
</success_criteria>

<output>
After completion, create `.planning/phases/05-data-display/05-03-SUMMARY.md`
</output>
